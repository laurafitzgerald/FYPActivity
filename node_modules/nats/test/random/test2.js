/*jshint -W083 */

var nats = require('nats').connect();
//var nats = require ('../').connect();

var buffer = new Buffer(10000);
for (var i = 0; i < 10000; i++) {
  buffer.write('a', i);
}
var s = buffer.toString();

var j = 1;
var end = 10000;

nats.subscribe('nats-test', function(msg, reply) {
  nats.publish(reply, s);
});

for (var i = 1; i <= end; i++) {
  nats.request('nats-test', function(response) {
    if (response.length != s.length) {
      console.log('s len', s.length);
      console.log('response len', response.length);
      console.log("j = ", j);
      throw new Error('Bad length');
    }
    if (++j === end) {
      console.log('done');
      process.exit(0);
    }
  });
}


nats.on('error', function(err) {
  console.log(err);
});
